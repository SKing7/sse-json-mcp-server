{
  "name": "SSEæ•°æ®è½¬æ¢å™¨ - å®Œæ•´ç‰ˆ",
  "nodes": [
    {
      "parameters": {},
      "id": "trigger-node",
      "name": "å¼€å§‹è½¬æ¢",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// åœ¨è¿™é‡Œè¾“å…¥æˆ–ç²˜è´´æ‚¨çš„SSEæ•°æ®\n// å¯ä»¥æ˜¯å•ä¸ªäº‹ä»¶æˆ–å¤šä¸ªäº‹ä»¶\n\nconst sseData = `event:onlineSearch\ndata:{\"eventIndex\":3,\"content\":{\"details\":[{\"stage\":\"webSearchKeywords\",\"title\":\"3ä¸ªæœç´¢å…³é”®è¯\",\"content\":[\"2025å¹´8æœˆ1æ—¥ ä»Šæ—¥æ–°é—»\",\"2025å¹´8æœˆ1æ—¥ å›½å†…å›½é™…æ–°é—»\",\"2025å¹´8æœˆ1æ—¥ çƒ­ç‚¹äº‹ä»¶\"],\"icon\":\"\",\"url\":\"\",\"toolName\":null}]}}\n\nevent:webSearch\ndata:{\"sub_type\":\"webSearch\",\"eventIndex\":4,\"type\":\"ClientEvent\",\"content\":\"å…¨ç½‘æ”¶é›†èµ„æ–™ä¸­\"}\n\nevent:webSearch\ndata:{\"sub_type\":\"webSearch\",\"eventIndex\":5,\"type\":\"ClientEvent\",\"content\":\"åˆ†ææµ·é‡æ•°æ®ä¸­\"}\n`;\n\n// è¿”å›æ•°æ®ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\nreturn {\n  rawSseData: sseData,\n  format: 'single',\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "code-input",
      "name": "è¾“å…¥SSEæ•°æ®",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        440,
        300
      ]
    },
    {
      "parameters": {
        "url": "http://127.0.0.1:3001/api/convert/sse-data",
        "authentication": "none",
        "requestMethod": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "rawData",
              "value": "={{ $json.rawSseData }}"
            },
            {
              "name": "format",
              "value": "={{ $json.format }}"
            }
          ]
        }
      },
      "id": "http-request",
      "name": "è°ƒç”¨è½¬æ¢API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        640,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// å¤„ç†APIå“åº”ç»“æœ\nconst response = $input.first().json;\n\nconsole.log('æ”¶åˆ°APIå“åº”:', JSON.stringify(response, null, 2));\n\nif (!response.success) {\n  return {\n    status: 'error',\n    message: 'âŒ è½¬æ¢å¤±è´¥',\n    error: response.error,\n    rawResponse: response\n  };\n}\n\nconst convertedEvents = response.data || [];\nconst results = [];\n\n// è§£ææ¯ä¸ªè½¬æ¢åçš„äº‹ä»¶\nfor (let i = 0; i < convertedEvents.length; i++) {\n  const event = convertedEvents[i];\n  const sseValue = event.value;\n  \n  // æå–äº‹ä»¶ç±»å‹\n  const eventTypeMatch = sseValue.match(/event:([^\\n]+)/);\n  const eventType = eventTypeMatch ? eventTypeMatch[1].trim() : 'unknown';\n  \n  // æå–æ•°æ®å†…å®¹\n  const dataMatch = sseValue.match(/data:([^\\n]+)/);\n  let parsedData = null;\n  let dataError = null;\n  \n  if (dataMatch) {\n    try {\n      parsedData = JSON.parse(dataMatch[1].trim());\n    } catch (e) {\n      dataError = `JSONè§£æå¤±è´¥: ${e.message}`;\n      parsedData = dataMatch[1].trim(); // ä¿ç•™åŸå§‹æ•°æ®\n    }\n  }\n  \n  results.push({\n    åºå·: i + 1,\n    äº‹ä»¶ç±»å‹: eventType,\n    æ—¶é—´æˆ³: event.timestamp,\n    æ•°æ®å†…å®¹: parsedData,\n    è§£æé”™è¯¯: dataError,\n    åŸå§‹SSE: sseValue.trim()\n  });\n}\n\nreturn {\n  status: 'success',\n  message: `âœ… æˆåŠŸè½¬æ¢ ${response.count} ä¸ªSSEäº‹ä»¶`,\n  æ€»äº‹ä»¶æ•°: response.count,\n  è½¬æ¢æ ¼å¼: response.format,\n  å¤„ç†æ—¶é—´: new Date().toISOString(),\n  è¯¦ç»†ç»“æœ: results,\n  APIå“åº”: response\n};"
      },
      "id": "process-result",
      "name": "å¤„ç†è½¬æ¢ç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        840,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// æ ¼å¼åŒ–æœ€ç»ˆè¾“å‡ºï¼Œä¾¿äºæŸ¥çœ‹\nconst input = $input.first().json;\n\n// å¦‚æœè½¬æ¢æˆåŠŸï¼Œæå–å…³é”®ä¿¡æ¯\nif (input.status === 'success') {\n  console.log('=== SSEè½¬æ¢æˆåŠŸ! ===');\n  console.log(`è½¬æ¢äº† ${input.æ€»äº‹ä»¶æ•°} ä¸ªSSEäº‹ä»¶`);\n  console.log('è¯¦ç»†ç»“æœ:');\n  \n  input.è¯¦ç»†ç»“æœ.forEach((event, index) => {\n    console.log(`\\näº‹ä»¶ ${event.åºå·}:`);\n    console.log(`  ç±»å‹: ${event.äº‹ä»¶ç±»å‹}`);\n    console.log(`  æ—¶é—´æˆ³: ${event.æ—¶é—´æˆ³}`);\n    console.log(`  æ•°æ®:`, JSON.stringify(event.æ•°æ®å†…å®¹, null, 2));\n    if (event.è§£æé”™è¯¯) {\n      console.log(`  é”™è¯¯: ${event.è§£æé”™è¯¯}`);\n    }\n  });\n} else {\n  console.log('=== è½¬æ¢å¤±è´¥ ===');\n  console.log('é”™è¯¯ä¿¡æ¯:', input.error);\n}\n\n// è¿”å›ç®€åŒ–çš„ç»“æœç”¨äºåç»­å¤„ç†\nreturn {\n  è½¬æ¢çŠ¶æ€: input.status,\n  äº‹ä»¶æ€»æ•°: input.æ€»äº‹ä»¶æ•° || 0,\n  è½¬æ¢æ—¶é—´: input.å¤„ç†æ—¶é—´,\n  äº‹ä»¶åˆ—è¡¨: input.è¯¦ç»†ç»“æœ?.map(event => ({\n    åºå·: event.åºå·,\n    ç±»å‹: event.äº‹ä»¶ç±»å‹,\n    æ•°æ®: event.æ•°æ®å†…å®¹\n  })) || [],\n  å®Œæ•´ç»“æœ: input\n};"
      },
      "id": "final-output",
      "name": "ğŸ“‹ æŸ¥çœ‹ç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        300
      ]
    }
  ],
  "connections": {
    "å¼€å§‹è½¬æ¢": {
      "main": [
        [
          {
            "node": "è¾“å…¥SSEæ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¾“å…¥SSEæ•°æ®": {
      "main": [
        [
          {
            "node": "è°ƒç”¨è½¬æ¢API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è°ƒç”¨è½¬æ¢API": {
      "main": [
        [
          {
            "node": "å¤„ç†è½¬æ¢ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†è½¬æ¢ç»“æœ": {
      "main": [
        [
          {
            "node": "ğŸ“‹ æŸ¥çœ‹ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  }
}
